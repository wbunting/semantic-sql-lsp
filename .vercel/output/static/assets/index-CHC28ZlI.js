const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-B4NKu6fZ.js","assets/chunk-D52XG6IA-Db5pw7u4.js","assets/main-BIpBA1Av.js"])))=>i.map(i=>d[i]);
import{bn as Ce,d8 as Ne,d9 as Ae,aq as Ee,da as le,db as ge,D as M,b as Re,dc as Oe,dd as ke,V as D,de as Ie,a2 as je,df as Fe,dg as $e,dh as Ve,di as We,dj as Be,dk as Te,dl as Ge,dm as Ue,dn as re,aO as H,dp as He,_ as Z,d as f,cC as xe,h as he,P as fe,ai as qe,bR as me,cA as Pe,bu as Je,cs as ee,dq as Ye,l as g,cJ as Ke,N as ne,aY as ze,cI as Qe,dr as Xe,ds as Ze,au as et,ag as tt,cS as nt,bg as it,f as Me,C as B,ce as ye,cu as rt,dt as ot,du as st,bx as at,M as ct,dv as pe,dw as dt,dx as ut,d6 as lt,dy as gt,dz as ht,Q as Se,U as _,dA as ft,dB as mt,W as pt,X as _t,$ as kt,Y as Tt,dC as yt,d7 as St,J as bt,dD as wt,ae as vt,S as Lt}from"./monaco-editor-wrapped-CqvvOqZY.js";import{_ as A}from"./home-VzGMATgR.js";import{I as De}from"./workbenchThemeService.service-BjKJFM4E.js";import{a as V,g as Ct,S as Et}from"./tokenClassificationRegistry-it1y1jrd.js";import"./chunk-D52XG6IA-Db5pw7u4.js";import"./with-props-GiQjMqHo.js";class It{constructor(e,t,n){this.id=e,this.dependencies=t,this.callback=n}}var I;(function(l){l[l.Uninitialized=1]="Uninitialized",l[l.InitializedInternal=2]="InitializedInternal",l[l.InitializedExternal=3]="InitializedExternal"})(I||(I={}));const K=class K{constructor(){this._isWebWorker=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",this._isRenderer=typeof document=="object",this._defineCalls=[],this._state=I.Uninitialized}_initialize(){var e,t;if(this._state===I.Uninitialized){if(globalThis.define){this._state=I.InitializedExternal;return}}else return;this._state=I.InitializedInternal,globalThis.define=(n,r,i)=>{typeof n!="string"&&(i=r,r=n,n=null),(typeof r!="object"||!Array.isArray(r))&&(i=r,r=null),this._defineCalls.push(new It(n,r,i))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??((e=window.trustedTypes)==null?void 0:e.createPolicy("amdLoader",{createScriptURL(n){if(n.startsWith(window.location.origin)||n.startsWith(`${Ce.vscodeFileResource}://${Ne}`))return n;throw new Error(`[trusted_script_src] Invalid script url: ${n}`)}})):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??((t=globalThis.trustedTypes)==null?void 0:t.createPolicy("amdLoader",{createScriptURL(n){return n}})))}async load(e){if(this._initialize(),this._state===I.InitializedExternal)return new Promise(o=>{const s=Ae();globalThis.define(s,[e],function(c){o(c)})});const t=await(this._isWebWorker?this._workerLoadScript(e):this._isRenderer?this._rendererLoadScript(e):this._nodeJSLoadScript(e));if(!t){console.warn(`Did not receive a define call from script ${e}`);return}const n={},r=[],i=[];if(Array.isArray(t.dependencies))for(const o of t.dependencies)o==="exports"?r.push(n):i.push(o);if(i.length>0)throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${i.join(", ")}`);return typeof t.callback=="function"?t.callback(...r)??n:t.callback}_rendererLoadScript(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("async","async"),r.setAttribute("type","text/javascript");const i=()=>{r.removeEventListener("load",o),r.removeEventListener("error",s)},o=c=>{i(),t(this._defineCalls.pop())},s=c=>{i(),n(c)};r.addEventListener("load",o),r.addEventListener("error",s),this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),r.setAttribute("src",e),window.document.getElementsByTagName("head")[0].appendChild(r)})}async _workerLoadScript(e){return this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),await import(e).then(t=>t.default??t),this._defineCalls.pop()}async _nodeJSLoadScript(e){try{const t=(await A(()=>import("fs"),[]).then(d=>d.default??d)).default,n=(await A(()=>import("vm"),[]).then(d=>d.default??d)).default,r=(await A(()=>import("module"),[]).then(d=>d.default??d)).default,i=Ee.parse(e).fsPath,o=t.readFileSync(i).toString(),s=r.wrap(o.replace(/^#!.*/,""));return new n.Script(s).runInThisContext().apply(),this._defineCalls.pop()}catch(t){throw t}}};K.INSTANCE=new K;let be=K;function xt(l,e){var o,s,c,a;(a=globalThis._VSCODE_PRODUCT_JSON??((c=(s=(o=globalThis.vscode)==null?void 0:o.context)==null?void 0:s.configuration())==null?void 0:c.product))!=null&&a.commit;const n=`${l}/${e}`,i=`${ge}/${n}`;return le.asBrowserUri(i).toString(!0)}class Pt extends M{constructor(e,t,n,r,i,o,s){super(),this._grammar=e,this._initialState=t,this._containsEmbeddedLanguages=n,this._createBackgroundTokenizer=r,this._backgroundTokenizerShouldOnlyVerifyTokens=i,this._reportTokenizationTime=o,this._reportSlowTokenization=s,this._seenLanguages=[],this._onDidEncounterLanguage=this._register(new Re),this.onDidEncounterLanguage=this._onDidEncounterLanguage.event}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(e,t,n){throw new Error("Not supported!")}createBackgroundTokenizer(e,t){if(this._createBackgroundTokenizer)return this._createBackgroundTokenizer(e,t)}tokenizeEncoded(e,t,n){const r=Math.random()*1e4<1,i=this._reportSlowTokenization||r,o=i?new Oe(!0):void 0,s=this._grammar.tokenizeLine2(e,n,500);if(i){const a=o.elapsed();(r||a>32)&&this._reportTokenizationTime(a,e.length,r)}if(s.stoppedEarly)return console.warn(`Time limit reached when tokenizing line: ${e.substring(0,100)}`),new ke(s.tokens,n);if(this._containsEmbeddedLanguages){const a=this._seenLanguages,d=s.tokens;for(let h=0,k=d.length>>>1;h<k;h++){const L=d[(h<<1)+1],v=D.getLanguageId(L);a[v]||(a[v]=!0,this._onDidEncounterLanguage.fire(v))}}let c;return n.equals(s.ruleStack)?c=n:c=s.ruleStack,new ke(s.tokens,c)}}class zt extends M{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(e,t,n,r){super(),this._encodedLanguageId=e,this._actual=t,this._maxTokenizationLineLength=r,this._register(Ie(this._maxTokenizationLineLength)),this._register(n)}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,n){throw new Error("Not supported!")}tokenizeEncoded(e,t,n){return e.length>=this._maxTokenizationLineLength.get()?je(this._encodedLanguageId,n):this._actual.tokenizeEncoded(e,t,n)}createBackgroundTokenizer(e,t){if(this._actual.createBackgroundTokenizer)return this._actual.createBackgroundTokenizer(e,t)}}const $=class ${static getChannel(e){return e.getChannel($.CHANNEL_NAME)}static setChannel(e,t){e.setChannel($.CHANNEL_NAME,t)}};$.CHANNEL_NAME="textMateWorkerHost";let oe=$;class Mt{constructor(e){this.edits=e.slice().sort(Fe(t=>t.offset,$e))}applyToArray(e){for(let t=this.edits.length-1;t>=0;t--){const n=this.edits[t];e.splice(n.offset,n.length,...new Array(n.newLength))}}}class Dt{constructor(e,t,n){this.offset=e,this.length=t,this.newLength=n}toString(){return`[${this.offset}, +${this.length}) -> +${this.newLength}}`}}class q{static fromMany(e){const t=e.map(n=>new q(n));return new Nt(t)}constructor(e){this.transformation=e,this.idx=0,this.offset=0}transform(e){let t=this.transformation.edits[this.idx];for(;t&&t.offset+t.length<=e;)this.offset+=t.newLength-t.length,this.idx++,t=this.transformation.edits[this.idx];if(!(t&&t.offset<=e))return e+this.offset}}class Nt{constructor(e){this.transformers=e}transform(e){for(const t of this.transformers){const n=t.transform(e);if(n===void 0)return;e=n}return e}}const Q=class Q extends M{constructor(e,t,n,r,i,o){super(),this._model=e,this._worker=t,this._languageIdCodec=n,this._backgroundTokenizationStore=r,this._configurationService=i,this._maxTokenizationLineLength=o,this.controllerId=Q._id++,this._pendingChanges=[],this._states=new Ve,this._loggingEnabled=We("editor.experimental.asyncTokenizationLogging",!1,this._configurationService),this._register(Ie(this._loggingEnabled)),this._register(this._model.onDidChangeContent(a=>{this._shouldLog&&console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:ie(a.changes)}),this._worker.$acceptModelChanged(this.controllerId,a),this._pendingChanges.push(a)})),this._register(this._model.onDidChangeLanguage(a=>{const d=this._model.getLanguageId(),h=this._languageIdCodec.encodeLanguageId(d);this._worker.$acceptModelLanguageChanged(this.controllerId,d,h)}));const s=this._model.getLanguageId(),c=this._languageIdCodec.encodeLanguageId(s);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:s,encodedLanguageId:c,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId}),this._register(Be(a=>{const d=this._maxTokenizationLineLength.read(a);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,d)}))}dispose(){super.dispose(),this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}async setTokensAndStates(e,t,n,r){if(this.controllerId!==e)return;let i=Te.deserialize(new Uint8Array(n));if(this._shouldLog&&console.log("received background tokenization result",{fileName:this._model.uri.fsPath.split("\\").pop(),updatedTokenLines:i.map(s=>s.getLineRange()).join(" & "),updatedStateLines:r.map(s=>new Ge(s.startLineNumber,s.startLineNumber+s.stateDeltas.length).toString()).join(" & ")}),this._shouldLog){const s=this._pendingChanges.filter(c=>c.versionId<=t).map(c=>c.changes).map(c=>ie(c)).join(" then ");console.log("Applying changes to local states",s)}for(;this._pendingChanges.length>0&&this._pendingChanges[0].versionId<=t;){const s=this._pendingChanges.shift();this._states.acceptChanges(s.changes)}if(this._pendingChanges.length>0){if(this._shouldLog){const a=this._pendingChanges.map(d=>d.changes).map(d=>ie(d)).join(" then ");console.log("Considering non-processed changes",a)}const s=q.fromMany(this._pendingChanges.map(a=>we(a.changes))),c=new Te;for(const a of i)for(let d=a.startLineNumber;d<=a.endLineNumber;d++)s.transform(d-1)!==void 0&&c.add(d,a.getLineTokens(d));i=c.finalize();for(const a of this._pendingChanges)for(const d of a.changes)for(let h=0;h<i.length;h++)i[h].applyEdit(d.range,d.text)}const o=q.fromMany(this._pendingChanges.map(s=>we(s.changes)));if(!this._applyStateStackDiffFn||!this._initialState){const{applyStateStackDiff:s,INITIAL:c}=await A(async()=>{const{applyStateStackDiff:a,INITIAL:d}=await import("./main-B4NKu6fZ.js").then(h=>h.m);return{applyStateStackDiff:a,INITIAL:d}},__vite__mapDeps([0,1])).then(a=>a.default??a);this._applyStateStackDiffFn=s,this._initialState=c}for(const s of r){let c=s.startLineNumber<=1?this._initialState:this._states.getEndState(s.startLineNumber-1);for(let a=0;a<s.stateDeltas.length;a++){const d=s.stateDeltas[a];let h;d?(h=this._applyStateStackDiffFn(c,d),this._states.setEndState(s.startLineNumber+a,h)):h=this._states.getEndState(s.startLineNumber+a);const k=o.transform(s.startLineNumber+a-1);k!==void 0&&this._backgroundTokenizationStore.setEndState(k+1,h),s.startLineNumber+a>=this._model.getLineCount()-1&&this._backgroundTokenizationStore.backgroundTokenizationFinished(),c=h}}this._backgroundTokenizationStore.setTokens(i)}get _shouldLog(){return this._loggingEnabled.get()}};Q._id=0;let se=Q;function we(l){return new Mt(l.map(e=>new Dt(e.range.startLineNumber-1,e.range.endLineNumber-e.range.startLineNumber+1,Ue(e.text)[0]+1)))}function ie(l){return l.map(e=>re.lift(e.range).toString()+" => "+e.text).join(" & ")}var G,x;let ae=(x=class{constructor(e,t,n,r,i,o,s,c){this._reportTokenizationTime=e,this._shouldTokenizeAsync=t,this._extensionResourceLoaderService=n,this._configurationService=r,this._languageService=i,this._environmentService=o,this._notificationService=s,this._telemetryService=c,this._workerProxyPromise=null,this._worker=null,this._workerProxy=null,this._workerTokenizerControllers=new Map,this._currentTheme=null,this._currentTokenColorMap=null,this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,n){if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing())return;const r=new H,i=this._getWorkerProxy().then(o=>{if(r.isDisposed||!o)return;const s={controller:void 0,worker:this._worker};return r.add(At(e,()=>{const c=new se(e,o,this._languageService.languageIdCodec,t,this._configurationService,n);return s.controller=c,this._workerTokenizerControllers.set(c.controllerId,c),Je(()=>{s.controller=void 0,this._workerTokenizerControllers.delete(c.controllerId),c.dispose()})})),s});return{dispose(){r.dispose()},requestTokens:async(o,s)=>{const c=await i;c!=null&&c.controller&&c.worker===this._worker&&c.controller.requestTokens(o,s)},reportMismatchingTokens:o=>{G._reportedMismatchingTokens||(G._reportedMismatchingTokens=!0,this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+o,name:"Async Tokenization Token Mismatch"}),this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{}))}}}setGrammarDefinitions(e){this._grammarDefinitions=e,this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e,this._currentTokenColorMap=t,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}_getWorkerProxy(){return this._workerProxyPromise||(this._workerProxyPromise=this._createWorkerProxy()),this._workerProxyPromise}async _createWorkerProxy(){const n=`${`${ge}/vscode-oniguruma`}/release/onig.wasm`,r={grammarDefinitions:this._grammarDefinitions,onigurumaWASMUri:le.asBrowserUri(n).toString(!0)},i=this._worker=He("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.worker","TextMateWorker");return oe.setChannel(i,{$readFile:async o=>{const s=Ee.revive(o);return this._extensionResourceLoaderService.readExtensionResource(s)},$setTokensAndStates:async(o,s,c,a)=>{const d=this._workerTokenizerControllers.get(o);d&&d.setTokensAndStates(o,s,c,a)},$reportTokenizationTime:(o,s,c,a,d)=>{this._reportTokenizationTime(o,s,c,a,d)}}),await i.proxy.$init(r),this._worker!==i?null:(this._workerProxy=i.proxy,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap),i.proxy)}_disposeWorker(){for(const e of this._workerTokenizerControllers.values())e.dispose();this._workerTokenizerControllers.clear(),this._worker&&(this._worker.dispose(),this._worker=null),this._workerProxy=null,this._workerProxyPromise=null}},G=x,x._reportedMismatchingTokens=!1,x);ae=G=Z([f(2,xe),f(3,he),f(4,fe),f(5,qe),f(6,me),f(7,Pe)],ae);function At(l,e){const t=new H,n=t.add(new H);function r(){l.isAttachedToEditor()?n.add(e()):n.clear()}return r(),t.add(l.onDidChangeAttached(()=>{r()})),t}class Rt{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(e){this._scopeNameToLanguageRegistration[e.scopeName]=e}getGrammarDefinition(e){return this._scopeNameToLanguageRegistration[e]||null}}const U="No TM Grammar registered for this language.";class Ot extends M{constructor(e,t,n,r){super(),this._host=e,this._initialState=n.INITIAL,this._scopeRegistry=new Rt,this._injections={},this._injectedEmbeddedLanguages={},this._languageToScope=new Map,this._grammarRegistry=this._register(new n.Registry({onigLib:r,loadGrammar:async i=>{const o=this._scopeRegistry.getGrammarDefinition(i);if(!o)return this._host.logTrace(`No grammar found for scope ${i}`),null;const s=o.location;try{const c=await this._host.readFile(s);return n.parseRawGrammar(c,s.path)}catch(c){return this._host.logError(`Unable to load and parse grammar for scope ${i} from ${s}`,c),null}},getInjections:i=>{const o=i.split(".");let s=[];for(let c=1;c<=o.length;c++){const a=o.slice(0,c).join(".");s=[...s,...this._injections[a]||[]]}return s}}));for(const i of t){if(this._scopeRegistry.register(i),i.injectTo){for(const o of i.injectTo){let s=this._injections[o];s||(this._injections[o]=s=[]),s.push(i.scopeName)}if(i.embeddedLanguages)for(const o of i.injectTo){let s=this._injectedEmbeddedLanguages[o];s||(this._injectedEmbeddedLanguages[o]=s=[]),s.push(i.embeddedLanguages)}}i.language&&this._languageToScope.set(i.language,i.scopeName)}}has(e){return this._languageToScope.has(e)}setTheme(e,t){this._grammarRegistry.setTheme(e,t)}getColorMap(){return this._grammarRegistry.getColorMap()}async createGrammar(e,t){const n=this._languageToScope.get(e);if(typeof n!="string")throw new Error(U);const r=this._scopeRegistry.getGrammarDefinition(n);if(!r)throw new Error(U);const i=r.embeddedLanguages;if(this._injectedEmbeddedLanguages[n]){const c=this._injectedEmbeddedLanguages[n];for(const a of c)for(const d of Object.keys(a))i[d]=a[d]}const o=Object.keys(i).length>0;let s;try{s=await this._grammarRegistry.loadGrammarWithConfiguration(n,t,{embeddedLanguages:i,tokenTypes:r.tokenTypes,balancedBracketSelectors:r.balancedBracketSelectors,unbalancedBracketSelectors:r.unbalancedBracketSelectors})}catch(c){throw c.message&&c.message.startsWith("No grammar provided for")?new Error(U):c}return{languageId:e,grammar:s,initialState:this._initialState,containsEmbeddedLanguages:o,sourceExtensionId:r.sourceExtensionId}}}const E=ee.registerExtensionPoint({extensionPoint:"grammars",deps:[Ye],jsonSchema:{description:g(7073,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:g(7074,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:g(7075,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:g(7076,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:g(7077,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:g(7078,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:g(7079,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:g(7080,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:g(7081,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var N,P;let ce=(P=class extends M{constructor(e,t,n,r,i,o,s,c,a,d){super(),this._languageService=e,this._themeService=t,this._extensionResourceLoaderService=n,this._notificationService=r,this._logService=i,this._configurationService=o,this._progressService=s,this._environmentService=c,this._instantiationService=a,this._telemetryService=d,this._createdModes=[],this._encounteredLanguages=[],this._debugMode=!1,this._debugModePrintFunc=()=>{},this._grammarDefinitions=null,this._grammarFactory=null,this._tokenizersRegistrations=new H,this._currentTheme=null,this._currentTokenColorMap=null,this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(ae,(h,k,L,v,S)=>this._reportTokenizationTime(h,k,L,v,!0,S),()=>this.getAsyncTokenizationEnabled()),this._vscodeOniguruma=null,this._styleElement=Ke(),this._styleElement.className="vscode-tokens-styles",E.setHandler(h=>this._handleGrammarsExtPoint(h)),this._updateTheme(this._themeService.getColorTheme(),!0),this._register(this._themeService.onDidColorThemeChange(()=>{this._updateTheme(this._themeService.getColorTheme(),!1)})),this._register(this._languageService.onDidRequestRichLanguageFeatures(h=>{this._createdModes.push(h)}))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null,this._grammarFactory&&(this._grammarFactory.dispose(),this._grammarFactory=null),this._tokenizersRegistrations.clear(),this._grammarDefinitions=[];for(const t of e){const n=t.value;for(const r of n){const i=this._validateGrammarDefinition(t,r);if(i&&(this._grammarDefinitions.push(i),i.language)){const o=new st(()=>this._createTokenizationSupport(i.language));this._tokenizersRegistrations.add(o),this._tokenizersRegistrations.add(ne.registerFactory(i.language,o))}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const t of this._createdModes)ne.getOrCreate(t)}_validateGrammarDefinition(e,t){if(!$t(e.description.extensionLocation,t,e.collector,this._languageService))return null;const n=ze(e.description.extensionLocation,t.path),r=Object.create(null);if(t.embeddedLanguages){const c=Object.keys(t.embeddedLanguages);for(let a=0,d=c.length;a<d;a++){const h=c[a],k=t.embeddedLanguages[h];typeof k=="string"&&this._languageService.isRegisteredLanguageId(k)&&(r[h]=this._languageService.languageIdCodec.encodeLanguageId(k))}}const i=Object.create(null);if(t.tokenTypes){const c=Object.keys(t.tokenTypes);for(const a of c)switch(t.tokenTypes[a]){case"string":i[a]=2;break;case"other":i[a]=0;break;case"comment":i[a]=1;break}}const o=t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0;function s(c,a){return!Array.isArray(c)||!c.every(d=>typeof d=="string")?a:c}return{location:n,language:o,scopeName:t.scopeName,embeddedLanguages:r,tokenTypes:i,injectTo:t.injectTo,balancedBracketSelectors:s(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:s(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){if(this._debugMode){this._notificationService.error(g(3084,"Already Logging."));return}this._debugModePrintFunc=e,this._debugMode=!0,this._debugMode&&this._progressService.withProgress({location:15,buttons:[g(3085,"Stop")]},n=>(n.report({message:g(3086,"Preparing to log TM Grammar parsing. Press Stop when finished.")}),this._getVSCodeOniguruma().then(r=>(r.setDefaultDebugCall(!0),n.report({message:g(3087,"Now logging TM Grammar parsing. Press Stop when finished.")}),new Promise((i,o)=>{})))),n=>{this._getVSCodeOniguruma().then(r=>{this._debugModePrintFunc=()=>{},this._debugMode=!1,r.setDefaultDebugCall(!1),t()})})}_canCreateGrammarFactory(){return!!this._grammarDefinitions}async _getOrCreateGrammarFactory(){if(this._grammarFactory)return this._grammarFactory;const[e,t]=await Promise.all([A(()=>import("./main-B4NKu6fZ.js").then(r=>r.m),__vite__mapDeps([0,1])).then(r=>r.default??r),this._getVSCodeOniguruma()]),n=Promise.resolve({createOnigScanner:r=>t.createOnigScanner(r),createOnigString:r=>t.createOnigString(r)});return this._grammarFactory?this._grammarFactory:(this._grammarFactory=new Ot({logTrace:r=>this._logService.trace(r),logError:(r,i)=>this._logService.error(r,i),readFile:r=>this._extensionResourceLoaderService.readExtensionResource(r)},this._grammarDefinitions||[],e,n),this._updateTheme(this._themeService.getColorTheme(),!0),this._grammarFactory)}async _createTokenizationSupport(e){if(!this._languageService.isRegisteredLanguageId(e)||!this._canCreateGrammarFactory())return null;try{const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),r=await t.createGrammar(e,n);if(!r.grammar)return null;const i=Vt("editor.maxTokenizationLineLength",e,-1,this._configurationService),o=new Pt(r.grammar,r.initialState,r.containsEmbeddedLanguages,(c,a)=>this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(c,a,i),()=>this.getAsyncTokenizationVerification(),(c,a,d)=>{this._reportTokenizationTime(c,e,r.sourceExtensionId,a,!1,d)},!0),s=o.onDidEncounterLanguage(c=>{if(!this._encounteredLanguages[c]){const a=this._languageService.languageIdCodec.decodeLanguageId(c);this._encounteredLanguages[c]=!0,this._languageService.requestBasicLanguageFeatures(a)}});return new zt(n,o,s,i)}catch(t){return t.message&&t.message===U||Qe(t),null}}_updateTheme(e,t){var i;if(!t&&this._currentTheme&&this._currentTokenColorMap&&Ft(this._currentTheme.settings,e.tokenColors)&&Xe(this._currentTokenColorMap,e.tokenColorMap))return;this._currentTheme={name:e.label,settings:e.tokenColors},this._currentTokenColorMap=e.tokenColorMap,(i=this._grammarFactory)==null||i.setTheme(this._currentTheme,this._currentTokenColorMap);const n=jt(this._currentTokenColorMap),r=Ze(n);this._styleElement.textContent=r,ne.setColorMap(n),this._currentTheme&&this._currentTokenColorMap&&this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}async createTokenizer(e){if(!this._languageService.isRegisteredLanguageId(e))return null;const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),{grammar:r}=await t.createGrammar(e,n);return r}_getVSCodeOniguruma(){return this._vscodeOniguruma||(this._vscodeOniguruma=(async()=>{const[e,t]=await Promise.all([A(()=>import("./main-BIpBA1Av.js").then(n=>n.m),__vite__mapDeps([2,1])).then(n=>n.default??n),this._loadVSCodeOnigurumaWASM()]);return await e.loadWASM({data:t,print:n=>{this._debugModePrintFunc(n)}}),e})()),this._vscodeOniguruma}async _loadVSCodeOnigurumaWASM(){return et?await(await fetch(xt("vscode-oniguruma","release/onig.wasm"))).arrayBuffer():await fetch(le.asBrowserUri(`${ge}/vscode-oniguruma/release/onig.wasm`).toString(!0))}_reportTokenizationTime(e,t,n,r,i,o){const s=i?"async":"sync";N.reportTokenizationTimeCounter[s]>50||(N.reportTokenizationTimeCounter[s]===0&&setTimeout(()=>{N.reportTokenizationTimeCounter[s]=0},1e3*60*60),N.reportTokenizationTimeCounter[s]++,this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:r,fromWorker:i,sourceExtensionId:n,isRandomSample:o,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0}))}},N=P,P.reportTokenizationTimeCounter={sync:0,async:0},P);ce=N=Z([f(0,fe),f(1,De),f(2,xe),f(3,me),f(4,tt),f(5,he),f(6,nt),f(7,it),f(8,Me),f(9,Pe)],ce);function jt(l){const e=[null];for(let t=1,n=l.length;t<n;t++)e[t]=B.fromHex(l[t]);return e}function Ft(l,e){if(!e||!l||e.length!==l.length)return!1;for(let t=e.length-1;t>=0;t--){const n=e[t],r=l[t];if(n.scope!==r.scope)return!1;const i=n.settings,o=r.settings;if(i&&o){if(i.fontStyle!==o.fontStyle||i.foreground!==o.foreground||i.background!==o.background)return!1}else if(!i||!o)return!1}return!0}function $t(l,e,t,n){if(e.language&&(typeof e.language!="string"||!n.isRegisteredLanguageId(e.language)))return t.error(g(3088,"Unknown language in `contributes.{0}.language`. Provided value: {1}",E.name,String(e.language))),!1;if(!e.scopeName||typeof e.scopeName!="string")return t.error(g(3089,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",E.name,String(e.scopeName))),!1;if(!e.path||typeof e.path!="string")return t.error(g(3090,"Expected string in `contributes.{0}.path`. Provided value: {1}",E.name,String(e.path))),!1;if(e.injectTo&&(!Array.isArray(e.injectTo)||e.injectTo.some(i=>typeof i!="string")))return t.error(g(3091,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",E.name,JSON.stringify(e.injectTo))),!1;if(e.embeddedLanguages&&!ye(e.embeddedLanguages))return t.error(g(3092,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",E.name,JSON.stringify(e.embeddedLanguages))),!1;if(e.tokenTypes&&!ye(e.tokenTypes))return t.error(g(3093,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",E.name,JSON.stringify(e.tokenTypes))),!1;const r=ze(l,e.path);return rt(r,l)||t.warn(g(3094,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",E.name,r.path,l.path)),!0}function Vt(l,e,t,n){return ot(r=>n.onDidChangeConfiguration(i=>{i.affectsConfiguration(l,{overrideIdentifier:e})&&r(i)}),()=>n.getValue(l,{overrideIdentifier:e})??t)}const C=Ct(),Wt=ee.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:g(3095,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(3096,"The identifier of the semantic token type"),pattern:V,patternErrorMessage:g(3097,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:g(3098,"The super type of the semantic token type"),pattern:V,patternErrorMessage:g(3099,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(3100,"The description of the semantic token type")}}}}}),Bt=ee.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:g(3101,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(3102,"The identifier of the semantic token modifier"),pattern:V,patternErrorMessage:g(3103,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(3104,"The description of the semantic token modifier")}}}}}),Gt=ee.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:g(3105,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:g(3106,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:g(3107,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class Ut{constructor(){function e(t,n,r){if(typeof t.id!="string"||t.id.length===0)return r.error(g(3108,"'configuration.{0}.id' must be defined and can not be empty",n)),!1;if(!t.id.match(V))return r.error(g(3109,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1;const i=t.superType;return i&&!i.match(V)?(r.error(g(3110,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1):typeof t.description!="string"||t.id.length===0?(r.error(g(3111,"'configuration.{0}.description' must be defined and can not be empty",n)),!1):!0}Wt.setHandler((t,n)=>{for(const r of n.added){const i=r.value,o=r.collector;if(!i||!Array.isArray(i)){o.error(g(3112,"'configuration.semanticTokenType' must be an array"));return}for(const s of i)e(s,"semanticTokenType",o)&&C.registerTokenType(s.id,s.description,s.superType)}for(const r of n.removed){const i=r.value;for(const o of i)C.deregisterTokenType(o.id)}}),Bt.setHandler((t,n)=>{for(const r of n.added){const i=r.value,o=r.collector;if(!i||!Array.isArray(i)){o.error(g(3113,"'configuration.semanticTokenModifier' must be an array"));return}for(const s of i)e(s,"semanticTokenModifier",o)&&C.registerTokenModifier(s.id,s.description)}for(const r of n.removed){const i=r.value;for(const o of i)C.deregisterTokenModifier(o.id)}}),Gt.setHandler((t,n)=>{for(const r of n.added){const i=r.value,o=r.collector;if(!i||!Array.isArray(i)){o.error(g(3114,"'configuration.semanticTokenScopes' must be an array"));return}for(const s of i){if(s.language&&typeof s.language!="string"){o.error(g(3115,"'configuration.semanticTokenScopes.language' must be a string"));continue}if(!s.scopes||typeof s.scopes!="object"){o.error(g(3116,"'configuration.semanticTokenScopes.scopes' must be defined as an object"));continue}for(const c in s.scopes){const a=s.scopes[c];if(!Array.isArray(a)||a.some(d=>typeof d!="string")){o.error(g(3117,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"));continue}try{const d=C.parseTokenSelector(c,s.language);C.registerTokenStyleDefault(d,{scopesToProbe:a.map(h=>h.split(" "))})}catch{o.error(g(3118,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",c))}}}}for(const r of n.removed){const i=r.value;for(const o of i)for(const s in o.scopes){const c=o.scopes[s];try{const a=C.parseTokenSelector(s,o.language);C.registerTokenStyleDefault(a,{scopesToProbe:c.map(d=>d.split(" "))})}catch{}}}})}}var R;let J=(R=class{constructor(e){this.instantiationService=e,this.instantiationService.createInstance(Ut)}},R.ID="workbench.contrib.tokenClassificationExtensionPoint",R);J=Z([f(0,Me)],J);at(J.ID,J,1);var Ht=".token-inspect-widget{border:1px solid var(--vscode-editorHoverWidget-border);padding:10px;user-select:text;-webkit-user-select:text;z-index:50}.hc-black .tokens-inspect-widget,.hc-light .tokens-inspect-widget{border-width:2px}.monaco-editor .token-inspect-widget{background-color:var(--vscode-editorHoverWidget-background)}.monaco-editor .token-inspect-widget .tiw-metadata-separator{background-color:var(--vscode-editorHoverWidget-border)}.tiw-token{font-family:var(--monaco-monospace-font)}.tiw-metadata-separator{border:0;height:1px}.tiw-token-length{float:right;font-size:60%;font-weight:400}.tiw-metadata-table{width:100%}.tiw-metadata-value{font-family:var(--monaco-monospace-font);word-break:break-word}.tiw-metadata-values{list-style:none;margin-right:-10px;max-height:300px;overflow-y:auto;padding-left:0}.tiw-metadata-values>.tiw-metadata-value{margin-right:10px}.tiw-metadata-key{min-width:150px;padding-right:10px;vertical-align:top;white-space:nowrap;width:1px}.tiw-metadata-semantic{font-style:italic}.tiw-metadata-scopes{line-height:normal}.tiw-theme-selector{font-family:var(--monaco-monospace-font)}";ct(Ht,{});function qt(l,e,t=!0){for(let n=e.length-1;n>=0;n--){const r=e.slice(0,n),i=e[n],o=Jt(l,i,r,t);if(o)return o}return null}function Jt(l,e,t,n){let r=null;for(let i=l.tokenColors.length-1;i>=0;i--){const o=l.tokenColors[i];if(n&&!o.settings.foreground)continue;let s;if(typeof o.scope=="string")s=o.scope.split(/,/).map(c=>c.trim());else if(Array.isArray(o.scope))s=o.scope;else continue;for(let c=0,a=s.length;c<a;c++){const d=s[c],h=new Y(d,o.settings);h.matches(e,t)&&h.isMoreSpecific(r)&&(r=h)}}return r}class Y{constructor(e,t){this.rawSelector=e,this.settings=t;const n=this.rawSelector.split(/ /);this.scope=n[n.length-1],this.parentScopes=n.slice(0,n.length-1)}matches(e,t){return Y._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(e===null&&t===null)return 0;if(e===null)return-1;if(t===null)return 1;if(e.scope.length!==t.scope.length)return e.scope.length-t.scope.length;const n=e.parentScopes.length,r=t.parentScopes.length;if(n!==r)return n-r;for(let i=0;i<n;i++){const o=e.parentScopes[i].length,s=t.parentScopes[i].length;if(o!==s)return o-s}return 0}isMoreSpecific(e){return Y._cmp(this,e)>0}static _matchesOne(e,t){const n=e+".";return e===t||t.substring(0,n.length)===n}static _matches(e,t,n,r){if(!this._matchesOne(e,n))return!1;let i=t.length-1,o=r.length-1;for(;i>=0&&o>=0;)this._matchesOne(t[i],r[o])&&i--,o--;return i===-1}}var de;const u=kt;var z;let O=(z=class extends M{static get(e){return e.getContribution(de.ID)}constructor(e,t,n,r,i,o,s,c){super(),this._editor=e,this._textMateService=t,this._treeSitterService=n,this._themeService=i,this._languageService=r,this._notificationService=o,this._configurationService=s,this._languageFeaturesService=c,this._widget=null,this._register(this._editor.onDidChangeModel(a=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(a=>this.stop())),this._register(this._editor.onKeyUp(a=>a.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==Ce.vscodeNotebookCell&&(this._widget=new ue(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}},de=z,z.ID="editor.contrib.inspectEditorTokens",z);O=de=Z([f(1,pe),f(2,dt),f(3,fe),f(4,De),f(5,me),f(6,he),f(7,ut)],O);class Yt extends Tt{constructor(){super({id:"editor.action.inspectTMScopes",label:g(3119,"Developer: Inspect Editor Tokens and Scopes"),alias:"Developer: Inspect Editor Tokens and Scopes",precondition:void 0})}run(e,t){const n=O.get(t);n==null||n.toggle()}}function ve(l){l.length>40&&(l=l.substr(0,20)+"…"+l.substr(l.length-20));let e="";for(let t=0,n=l.length;t<n;t++){const r=l.charCodeAt(t);switch(r){case 9:e+="→";break;case 32:e+="·";break;default:e+=String.fromCharCode(r)}}return e}const X=class X extends M{constructor(e,t,n,r,i,o,s,c){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=r,this._themeService=i,this._textMateService=t,this._treeSitterService=n,this._notificationService=o,this._configurationService=s,this._languageFeaturesService=c,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new lt,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(a=>this._beginCompute(this._editor.getPosition()))),this._register(i.onDidColorThemeChange(a=>this._beginCompute(this._editor.getPosition()))),this._register(s.onDidChangeConfiguration(a=>a.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return X._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId()),n=this._computeSemanticTokens(e),r=this._treeSitterService.getParseResult(this._model);gt(this._domNode),this._domNode.appendChild(document.createTextNode(g(3120,"Loading..."))),Promise.all([t,n]).then(([i,o])=>{this._isDisposed||(this._compute(i,o,r==null?void 0:r.tree,e),this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`,this._editor.layoutContentWidget(this))},i=>{this._notificationService.warn(i),setTimeout(()=>{var o;(o=O.get(this._editor))==null||o.stop()})})}_isSemanticColoringEnabled(){var t;const e=(t=this._configurationService.getValue(ht,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri}))==null?void 0:t.enabled;return typeof e=="boolean"?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,n,r){var L;const i=e&&this._getTokensAtPosition(e,r),o=t&&this._getSemanticTokenAtPosition(t,r),s=n&&this._getTreeSitterTokenAtPosition(n,r);if(!i&&!o&&!s){Se(this._domNode,"No grammar or semantic tokens available.");return}const c=i==null?void 0:i.metadata,a=o==null?void 0:o.metadata,d=o&&ve(this._model.getValueInRange(o.range)),h=i&&ve(this._model.getLineContent(r.lineNumber).substring(i.token.startIndex,i.token.endIndex)),k=d||h||"";if(Se(this._domNode,u("h2.tiw-token",void 0,k,u("span.tiw-token-length",void 0,`${k.length} ${k.length===1?"char":"chars"}`))),_(this._domNode,u("hr.tiw-metadata-separator",{style:"clear:both"})),_(this._domNode,u("table.tiw-metadata-table",void 0,u("tbody",void 0,u("tr",void 0,u("td.tiw-metadata-key",void 0,"language"),u("td.tiw-metadata-value",void 0,(c==null?void 0:c.languageId)||"")),u("tr",void 0,u("td.tiw-metadata-key",void 0,"standard token type"),u("td.tiw-metadata-value",void 0,this._tokenTypeToString((c==null?void 0:c.tokenType)||0))),...this._formatMetadata(a,c)))),o){_(this._domNode,u("hr.tiw-metadata-separator"));const v=_(this._domNode,u("table.tiw-metadata-table",void 0)),S=_(v,u("tbody",void 0,u("tr",void 0,u("td.tiw-metadata-key",void 0,"semantic token type"),u("td.tiw-metadata-value",void 0,o.type))));if(o.modifiers.length&&_(S,u("tr",void 0,u("td.tiw-metadata-key",void 0,"modifiers"),u("td.tiw-metadata-value",void 0,o.modifiers.join(" ")))),o.metadata){const T=["foreground","bold","italic","underline","strikethrough"],y={},b=new Array;for(const m of T)if(o.metadata[m]!==void 0){const w=o.definitions[m],j=this._renderTokenStyleDefinition(w,m),F=j.map(p=>ft(p)?p.outerHTML:p).join();let W=y[F];W||(y[F]=W=[],b.push([j,F])),W.push(m)}for(const[m,w]of b)_(S,u("tr",void 0,u("td.tiw-metadata-key",void 0,y[w].join(", ")),u("td.tiw-metadata-value",void 0,...m)))}}if(i){const v=this._themeService.getColorTheme();_(this._domNode,u("hr.tiw-metadata-separator"));const S=_(this._domNode,u("table.tiw-metadata-table")),T=_(S,u("tbody"));h&&h!==k&&_(T,u("tr",void 0,u("td.tiw-metadata-key",void 0,"textmate token"),u("td.tiw-metadata-value",void 0,`${h} (${h.length})`)));const y=new Array;for(let w=i.token.scopes.length-1;w>=0;w--)y.push(i.token.scopes[w]),w>0&&y.push(u("br"));_(T,u("tr",void 0,u("td.tiw-metadata-key",void 0,"textmate scopes"),u("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...y)));const b=qt(v,i.token.scopes,!1),m=(L=o==null?void 0:o.metadata)==null?void 0:L.foreground;if(b){if(m!==i.metadata.foreground){let w=u("code.tiw-theme-selector",void 0,b.rawSelector,u("br"),JSON.stringify(b.settings,null,"	"));m&&(w=u("s",void 0,w)),_(T,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,w)))}}else m||_(T,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,"No theme selector")))}if(s){_(this._domNode,u("hr.tiw-metadata-separator"));const v=_(this._domNode,u("table.tiw-metadata-table")),S=_(v,u("tbody"));_(S,u("tr",void 0,u("td.tiw-metadata-key",void 0,"tree-sitter token"),u("td.tiw-metadata-value",void 0,`${s.text}`)));const T=new Array;let y=s;for(;y.parent;)T.push(y.type),y=y.parent,y&&T.push(u("br"));_(S,u("tr",void 0,u("td.tiw-metadata-key",void 0,"tree-sitter scopes"),u("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...T)));const b=mt.get(this._model.getLanguageId()),m=b==null?void 0:b.captureAtPosition(r.lineNumber,r.column,this._model);m&&m.length>0&&_(S,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,m[m.length-1].name)))}}_formatMetadata(e,t){const n=new Array;function r(a){const d=(e==null?void 0:e[a])||(t==null?void 0:t[a]);if(d!==void 0){const h=e!=null&&e[a]?"tiw-metadata-semantic":"";n.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,a),u(`td.tiw-metadata-value.${h}`,void 0,d)))}return d}const i=r("foreground"),o=r("background");if(i&&o){const a=B.fromHex(o),d=B.fromHex(i);a.isOpaque()?n.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"contrast ratio"),u("td.tiw-metadata-value",void 0,a.getContrastRatio(d.makeOpaque(a)).toFixed(2)))):n.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),u("td.tiw-metadata-value")))}const s=new Array;function c(a){let d;e&&e[a]?d=u("span.tiw-metadata-semantic",void 0,a):t&&t[a]&&(d=a),d&&(s.length&&s.push(" "),s.push(d))}return c("bold"),c("italic"),c("underline"),c("strikethrough"),s.length&&n.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"font style"),u("td.tiw-metadata-value",void 0,...s))),n}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,n=D.getLanguageId(e),r=D.getTokenType(e),i=D.getFontStyle(e),o=D.getForeground(e),s=D.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,bold:i&2?!0:void 0,italic:i&1?!0:void 0,underline:i&4?!0:void 0,strikethrough:i&8?!0:void 0,foreground:t[o],background:t[s]}}_tokenTypeToString(e){switch(e){case 0:return"Other";case 1:return"Comment";case 2:return"String";case 3:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const n=t.lineNumber,r=this._getStateBeforeLine(e,n),i=e.tokenizeLine(this._model.getLineContent(n),r),o=e.tokenizeLine2(this._model.getLineContent(n),r);let s=0;for(let a=i.tokens.length-1;a>=0;a--){const d=i.tokens[a];if(t.column-1>=d.startIndex){s=a;break}}let c=0;for(let a=o.tokens.length>>>1;a>=0;a--)if(t.column-1>=o.tokens[a<<1]){c=a;break}return{token:i.tokens[s],metadata:this._decodeMetadata(o.tokens[(c<<1)+1])}}_getStateBeforeLine(e,t){let n=null;for(let r=1;r<t;r++)n=e.tokenizeLine(this._model.getLineContent(r),n).ruleStack;return n}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const r=t[0],i=await Promise.resolve(r.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(i))return{tokens:i,legend:r.getLegend()}}const n=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(n.length){const r=n[0],i=e.lineNumber,o=new re(i,1,i,this._model.getLineMaxColumn(i)),s=await Promise.resolve(r.provideDocumentRangeSemanticTokens(this._model,o,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(s))return{tokens:s,legend:r.getLegend()}}return null}_getSemanticTokenAtPosition(e,t){const n=e.tokens.data,r=this._model.getLanguageId();let i=0,o=0;const s=t.lineNumber-1,c=t.column-1;for(let a=0;a<n.length;a+=5){const d=n[a],h=n[a+1],k=n[a+2],L=n[a+3],v=n[a+4],S=i+d,T=d===0?o+h:h;if(s===S&&T<=c&&c<T+k){const y=e.legend.tokenTypes[L]||"not in legend (ignored)",b=[];let m=v;for(let te=0;m>0&&te<e.legend.tokenModifiers.length;te++)m&1&&b.push(e.legend.tokenModifiers[te]),m=m>>1;m>0&&b.push("not in legend (ignored)");const w=new re(S+1,T+1,S+1,T+1+k),j={},F=this._themeService.getColorTheme().tokenColorMap,p=this._themeService.getColorTheme().getTokenStyleMetadata(y,b,r,!0,j);let _e;return p&&(_e={languageId:void 0,tokenType:0,bold:p==null?void 0:p.bold,italic:p==null?void 0:p.italic,underline:p==null?void 0:p.underline,strikethrough:p==null?void 0:p.strikethrough,foreground:F[(p==null?void 0:p.foreground)||0],background:void 0}),{type:y,modifiers:b,range:w,metadata:_e,definitions:j}}i=S,o=T}return null}_walkTreeforPosition(e,t){const n=this._model.getOffsetAt(t);e.gotoFirstChild();let r=!1,i=null;do e.currentNode.startIndex<=n&&n<e.currentNode.endIndex?(r=!0,i=e.currentNode):r=!1;while(r?e.gotoFirstChild():e.gotoNextSibling());return i}_getTreeSitterTokenAtPosition(e,t){const n=e.walk();return this._walkTreeforPosition(n,t)}_renderTokenStyleDefinition(e,t){const n=new Array;if(e===void 0)return n;const r=this._themeService.getColorTheme();if(Array.isArray(e)){const i={};r.resolveScopes(e,i);const o=i[t];if(o&&i.scope){const s=u("ul.tiw-metadata-values"),c=Array.isArray(o.scope)?o.scope:[String(o.scope)];for(const a of c)s.appendChild(u("li.tiw-metadata-value.tiw-metadata-scopes",void 0,a));return n.push(i.scope.join(" "),s,u("code.tiw-theme-selector",void 0,JSON.stringify(o.settings,null,"	"))),n}return n}else if(Et.is(e)){const i=r.getTokenStylingRuleScope(e);return i==="setting"?(n.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n):(i==="theme"&&n.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n)}else{const i=r.resolveTokenStyleValue(e);return n.push(`Default: ${i?this._renderStyleProperty(i,t):""}`),n}}_renderStyleProperty(e,t){switch(t){case"foreground":return e.foreground?B.Format.CSS.formatHexA(e.foreground,!0):"";default:return e[t]!==void 0?String(e[t]):""}}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}};X._ID="editor.contrib.inspectEditorTokensWidget";let ue=X;pt(O.ID,O,4);_t(Yt);const Le=new URL("/assets/onig-Du5pRr7Y.wasm",import.meta.url).href;yt({"vscode-oniguruma/../onig.wasm":Le,"vs/../../node_modules/vscode-oniguruma/release/onig.wasm":Le});wt(async l=>{l.get(vt).when(2).then(()=>{Lt.get(pe)})});function nn(){return{...St(),[pe.toString()]:new bt(ce,[],!1)}}export{pe as ITextMateTokenizationService,nn as default};
